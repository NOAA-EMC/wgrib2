<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>Climate Prediction Center - wgrib2: -rpn example</title>
  <meta http-equiv=Content-Type content="text/html; charset=windows-1252">
  <meta content="NCEP Web Team" name="GENERATOR">
  <meta name="keywords"
  content="Climate,Climate Prediction Center,National Weather Service,National Oceanic &amp; Atmospheric Administration, NOAA,El Nino,La Nina,ENSO,climate outlooks,El Nino Advisory,La Nina Advisory,droughts,hurricanes,Threats Assessment,Drought Assessment,Drought Monitor,CLimate Diagnostics Bulletin,6-10 day outlook,8-14 day outlook, 6-10 day forecast,8-14 day forecast,MRF,UV Index,North Atlantic Oscillation,NAO,Pacific Decadal Oscillation,PDO,sea surface temperatures,SST,Palmer Drought Severity Index, African Desk,outlooks,expert assessments,monitoring,advisories,stratosphere,temperature,precipitation,snow cover,snowfall,soil moisture,OLR,ozone,degree days,CLIMATE,CLIMATE PREDICTION CENTER,EL NINO,LA NINA, CLIMATE OUTLOOKS,HURRICANES,ASSESSMENTS,SNOW,STRATOSPHERE,DROUGHT,OZONE,DEGREE DAYS">
  <link href="/nwscwi/main.css" type="text/css" rel="STYLESHEET">
</head>
<body leftmargin="0" background="/nwscwi/background.gif" 
      topmargin="0" rightmargin="0" marginheight="0" marginwidth="0">
<table cellspacing="0" cellpadding="0" width="100%" background="/nwscwi/topbanner.jpg" border="0">
  <tr>
    <td align="right" height="19">
      <a href="#contents"><img height="1" alt="Skip Navigation Links"
         src="/nwscwi/skipgraphic.gif" width="1" border="0"></a>
      <a href="https://www.nws.noaa.gov/" class="homepagelinks"><span class="nwslink">www.nws.noaa.gov</span></a>&nbsp;</td>
  </tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%" border="0">
  <tr>
    <td rowspan="2"><a href="https://www.noaa.gov/">
      <img height="78" alt="NOAA logo - Click to go to the NOAA home page"
      src="/nwscwi/noaaleft.jpg" width="85" border="0"></a></td>
    <td align="left"><img height="20" alt="National Weather Service"
      src="/nwscwi/nws_title.jpg" width="500" border="0"></td>
    <td rowspan="2" width="100%" background="/nwscwi/ncep_bkgrnd.jpg">&nbsp;</td>
    <td rowspan="2" align="right"><a href="https://www.nws.noaa.gov/">
      <img height="78" alt="NWS logo - Click to go to the NWS home page"
      src="/nwscwi/nwsright.jpg" width="85" border="0"></a></td>
  </tr>
  <tr>
    <td><img height="58" alt="Climate Prediction Center" src="/nwscwi/cpc.jpg"
             width="500" border="0"></td>    <!-- Put your center header image here. -->
  </tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%" background="/nwscwi/navbkgrnd.gif" border="0">
  <tr>
    <td align="left" valign="top" width="94"><img height="23" alt="" src="/nwscwi/navbarleft.jpg" width
="94" border="0"></td>
    <td class="nav" align="center" width="15%">
      <a href="/products/site_index.html" class="menu">Site Map</a></td> <!-- Build a text only sitemap, and link to it via this
                                                    sitemap button just below the banner.
                                                    The sitemap should include a heirarchy of links
                                                    from NOAA, to the NWS, to NCEP, and then through your site. -->
    <td class="nav" align="right" width="15%">
      <a href="https://www.nws.noaa.gov/pa/" class="menu">News</a></td>
    <td class="nav" id="menuitem" align="right" width="20%">
      <a href="https://weather.gov/organization.php" class="menu">Organization</a></td>
    <td class="yellow" align="right" width="20%">
      <form action="https://www.firstgov.gov/fgsearch/index.jsp" name="query">
        <label for="search">Search</label>&nbsp;</td>
    <td align="left" class="searchinput" width="20%" nowrap>
      <input type="hidden" name="parsed" value="true">
      <input type="hidden" name="rn" value="3">
      <input type="hidden" name="in0" value="domain">
      <input type="hidden" name="dom0" value="nws.noaa.gov, weather.gov, wrh.noaa.gov, srh.noaa.gov, crh.noaa.gov, prh.noaa.gov, arh.noaa.gov, alaska.net/~nwsar, erh.noaa.gov, ncep.noaa.gov, wwb.noaa.gov, spc.noaa.gov, nhc.noaa.gov, sec.noaa.gov, aviationweather.gov, aviationweather.noaa.gov, weather.noaa.gov, roc.noaa.gov, nohrsc.nws.gov, nwstc.noaa.gov, wdtb.noaa.gov, npmoc.navy.mil, ndbc.noaa.gov">
      <input type="text" name="mw0" value="All NWS Search" id="search" size="20" maxlength="256">
      <input type="submit" name="Go2" value="Go"></td>
    <td width="10%">&nbsp;</form></td>
    <td align="right" valign="bottom" width="24"><img height="23" alt="" src="/nwscwi/navbarendcap.jpg"
 width="24" border="0"></td>
  </tr>
</table>
<table cellspacing="0" cellpadding="0" width="670" border="0">
  <tr valign="top">
    <td width="137"><br>
      <table cellspacing="0" cellpadding="2" width="137" border="0">
        <!-- Do not remove this section. You will need this when the City,St/zip search is implemented nationwide.-->
        <!-- <tr align="left" valign="top">
                <td class="searchinput">
                  <div id="Layer2" style="position:absolute; width:200px; height:115px; z-index:2; visibility: hidden">Search by city or zip code. Press enter or select the go button to submit request</div>
                  <form method="POST" action="https://www.srh.noaa.gov/zipcity.php">
                  <span class="yellow">Local forecast by<br>&quot;City, St&quot; or Zip Code</span><br>
                  <input type="text" name="inputstring" size="9" value="City, St">
                  <input type="submit" name="Go2" value="Go"></form></td>
        </tr> -->
         <tr>
          <td class="searchinput" align="left">
            <form action="https://www.firstgov.gov/fgsearch/index.jsp" name="query">
             <label for="search"><span class="yellow">CPC Search</span></label>
              <input type="hidden" name="parsed" value="true">
              <input type="hidden" name="rn" value="3">
              <input type="hidden" name="in0" value="domain">
              <input type="hidden" name="dom0" value="www.cpc.ncep.noaa.gov">
              <input type="text" name="mw0" id="search"  size="10" maxLength="256" value="CPC search">&nbsp;
              <input type="submit" name="Go2" value="Go">
          </form></td>
         </tr>
        <tr>
          <td class="white">
            <span class="yellow">About Us</span><br>
            &nbsp;&nbsp;&nbsp;<a href="/information/who_we_are/mission.html" class="menu">Our Mission</a><br>
            &nbsp;&nbsp;&nbsp;<a href="/information/who_we_are/" class="menu">Who We Are</a><br><br>
            <span class="yellow">Contact Us</span><br>
            &nbsp;&nbsp;&nbsp;<a href="/information/personnel/contacts.html" class="menu">CPC Information</a><br>
            &nbsp;&nbsp;&nbsp;<a href="/comment-form.html" class="menu">CPC Web Team</a><br><br>           
          </td>
        </tr>
      </table>
    </td>
    <td valign="top" align="center" width="533"><a name="contents"></a>

<!-- Begin content area -->

<table border="0" cellPadding="2" cellSpacing="0" align="center" width="533">
 <tr><td>&nbsp;</td></tr>
 <tr>
  <td>
   <font face="Verdana,arial,serif" size="1"><a href="/index.html" class="homepagelinks"><strong>HOME</strong></a> &gt; <a href="/products/monitoring_and_data" class="homepagelinks">Monitoring_and_Data</a> &gt; <a href="/products/monitoring_and_data/oadata.html" class="homepagelinks">Oceanic and Atmospheric Data</a> &gt; <a href="/products/wesley/" class="homepagelinks">Reanalysis: Atmospheric Data</a> &gt; wgrib2-rpn example</font>
  </td>
 </tr>
 <tr><td>&nbsp;</td></tr>
 <tr>
  <td>
<font color=red>
<h3 align=center>wgrib2: -rpn to Calculate Dewpoint and Total-Total Index</h3>
</font>


<h3>Introduction</h3>

<p>
The <font color=red>-rpn</font> option runs a reverse Polish notation 
(<a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">RPN</a>)
calculator. In this example, I will show how to 
calculate the dewpoint and total-total index in wgrib2.  The total-total index
correlates with the thunderstorm strength and coverage.

</p>

<pre>
TT = (T850-T500) + (Td850 - T500)

Td850 = dewp point temperature at 850 mb in C
T500 = temperature at the 500 mb level in C
T850 = temperature at the 850 mb level in C
</pre>

<p>
The above expression for TT can be written in reverse Polish (postfix)
notation as,

<pre>
 T850 T500 - Td850 T500 - +
</pre>

The conversion to reverse Polish is not unique and can be done without electronic aids.
However, we will be doing more complicated expressions and on-line converters
are handy.  In a web search, the first two sites that I found were,
</p>
<a href="https://www.mathblog.dk/tools/infix-postfix-converter/">
https://www.mathblog.dk/tools/infix-postfix-converter/</a><br>

<a href="https://scanftree.com/Data_Structure/prefix-postfix-infix-online-converter">
https://scanftree.com/Data_Structure/prefix-postfix-infix-online-converter</a><br>

<p>
To use these sites, enter the expression in the infix box and press the convert
button.  By the way, this list is not a endorsement.  If I had more patience, I could have found
more sites.  With a different search engine, I may have found two different
sites.  Anyways with the above postfix expression, the sh script to calculate
the total-total index is,

<pre>
     1	#!/bin/sh
     2	# calculate total total index
     3	#
     4	#  file = grib2 file with T850 T500 and Td850 (DPT)
     5	#
     6	# calulate total total index by
     7	# TT = (T850 - T500) + (Td850 - T500)
     8	# TT in reverse polish is T850 T500 - Td850 T500 - +
     9	
    10	file=gdas1.t00z.pgrbanl.grib2
    11	
    12	wgrib2 $file \
    13	  -grib out.grb2 \
    14	  -if ":TMP:500 mb:" -rpn "273.15:-:sto_1" -print "saved T500 in reg1" -fi \
    15	  -if ":TMP:850 mb:" -rpn "273.15:-:sto_2" -print "saved T850 in reg2" -fi \
    16	  -if ":DPT:850 mb:" -rpn "273.15:-:sto_3" -print "saved Td850 in reg3" -fi \
    17	  -if_reg "1:2:3" -print ":ready to do work"  \
    18	      -rpn "rcl_2:rcl_1:-:rcl_3:rcl_1:-:+" \
    19	      -set_var TOTALX -grib_out out.grb2 \
    20	  -if_reg "1:2:3" -rpn "clr_1:clr_2:clr_3" -fi

Line 13 saves each field in file out.grb2
Line 14 saves T500 (C) in register 1, converts from K to C.
Line 15 saves T850 (C) in register 2
Line 16 saves Td850 (C) in register 3
Line 17 if register 1, 2 and 3 are defined then
Line 18 calculates TT
Line 19 writes TT to out.grb2
Line 20 clears registers so that lines 17-19 are only done once
</pre>

<p> 
The problem with using the above script with the GFS is that the standard
GFS output does not include dewpoint temperature.  You have to compute the
dewpoint from the relative or specific humidity.  See the comments
in the following script for the formula used.

<pre>
     1	#!/bin/sh
     2	# calculate total total index
     3	#
     4	#  file = grib2 file with T850 T500 and RH850
     5	#
     6	# step 1: calculate 850 mb dewpoint temp
     7	# got formula from here: https://en.wikipedia.org/wiki/Dew_point (retrieved 12/2013)
     8	#
     9	#     gamma = (ln(RH / 100) + (b * T) / (c + T)
    10	#         let r3 = ln(RH/100)
    11	#         gamma:  r3 b T * c T + / +
    12	#     Td = (c*gamma) / (b-gamma)
    13	#       Td: c gamma * b gamma - /
    14	#
    15	#  some values of (b,c):   18.678, 257.14C  Bolton 1980 MWR
    16	#  some values of (b,c):   17.62, 243.12C   Sontag 1990
    17	#  some values of (b,c):   17.27, 2137.7C   Paroscientific
    18	#
    19	#
    20	# calulate total total index by
    21	# TT = (T850 - T500) + (Td850 - T500)
    22	
    23	file=gdas1.t00z.pgrbanl.grib2
    24	
    25	wgrib2 $file \
    26	  -grib out.grb2 \
    27	  -if ":TMP:500 mb:" -rpn "273.15:-:sto_1" -print "saved T500 in reg1" -fi \
    28	  -if ":TMP:850 mb:" -rpn "273.15:-:sto_2" -print "saved T850 in reg2" -fi \
    29	  -if ":RH:850 mb:"  -rpn "100:/:ln:sto_3" -print "saved LN(RH850/100) in reg3" -fi \
    30	  -if_reg "1:2:3" -print ":calc Td850"  \
    31	      -rpn "rcl_3:18.678:rcl_2:*:257.14:rcl_2:+:/:+:sto_4:" \
    32	      -rpn "257.14:rcl_4:*:18.678:rcl_4:-:/:sto_5:273.15:+" -set_var DPT -grib_out out.grb2 \
    33	  -if_reg "5"  -rpn "rcl_2:rcl_1:-:rcl_5:rcl_1:-:+" -set_var TOTALX -grib_out out.grb2 \
    34    -if_reg "5"  -rpn "clr_1:clr_2:clr_3:clr_4:clr_5" -fi

Line 26 saves each field in file out.grb2
Line 27 saves T500 (C) in register 1, converts from K to C.
Line 28 saves T850 (C) in register 2
Line 29 saves ln(RH850/100) in register 3
Line 30-32 computes dewpoint and saves in register 5 (C) and writes to grib file (K)
Line 33 computes total-total index and writes it out
Line 34 clears registers
</pre>

<p>
Note that the above script requires wgrib2 v2.0.0 to run. Previous versions
had a problem with the ln function.  In hindsight, -if should have been
always closed by -fi rather than an output or a -fi.

</td>
</tr>


<!--  End of Content area  -->
<!--   ...............................................Footer Portion.........................................    -->
 <tr>
  <td>
   <table width="500">
    <tr>
     <td colSpan="3"><hr></td>
    </tr>
    <TR vAlign="top">
     <TD class="gray">
      <A href="https://www.noaa.gov/" class="homepagelinks"><SPAN class="gray">NOAA/</SPAN></A>
      <A href="https://www.nws.noaa.gov/" class="homepagelinks"><SPAN class="gray">National Weather Service</SPAN></A><BR>
      <A href="https://www.ncep.noaa.gov/" class="homepagelinks"><SPAN class="gray">National Centers for Environmental Prediction</SPAN></a><BR>
        Climate Prediction Center<BR>
        5830 University Research Court<BR>
        College Park, Maryland 20740<BR>
      <A href="/comment-form.html" class="homepagelinks"><SPAN class="gray">Climate Prediction Center Web Team</SPAN></A><BR>
        Page last modified: Dec 10, 2013
     </TD>
     <TD>
      <A href="https://weather.gov/disclaimer.php" class="homepagelinks"><SPAN class="gray">Disclaimer</SPAN></A>
     </TD>
     <TD align="right">
      <A href="https://weather.gov/privacy.php" class="homepagelinks"> <SPAN class="gray">Privacy Policy</SPAN></A>
     </TD>
    </TR>
   </table>
  </td>
 </tr>
</table>
</td>
</tr>
</table>
</body>
</html>

