<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>Climate Prediction Center - wgrib2: -new_grid</title>
  <meta http-equiv=Content-Type content="text/html; charset=windows-1252">
  <meta content="NCEP Web Team" name="GENERATOR">
  <meta name="keywords"
  content="Climate,Climate Prediction Center,National Weather Service,National Oceanic &amp; Atmospheric Administration, NOAA,El Nino,La Nina,ENSO,climate outlooks,El Nino Advisory,La Nina Advisory,droughts,hurricanes,Threats Assessment,Drought Assessment,Drought Monitor,CLimate Diagnostics Bulletin,6-10 day outlook,8-14 day outlook, 6-10 day forecast,8-14 day forecast,MRF,UV Index,North Atlantic Oscillation,NAO,Pacific Decadal Oscillation,PDO,sea surface temperatures,SST,Palmer Drought Severity Index, African Desk,outlooks,expert assessments,monitoring,advisories,stratosphere,temperature,precipitation,snow cover,snowfall,soil moisture,OLR,ozone,degree days,CLIMATE,CLIMATE PREDICTION CENTER,EL NINO,LA NINA, CLIMATE OUTLOOKS,HURRICANES,ASSESSMENTS,SNOW,STRATOSPHERE,DROUGHT,OZONE,DEGREE DAYS">
  <link href="/nwscwi/main.css" type="text/css" rel="STYLESHEET">
</head>
<body leftmargin="0" background="/nwscwi/background.gif" 
      topmargin="0" rightmargin="0" marginheight="0" marginwidth="0">
<table cellspacing="0" cellpadding="0" width="100%" background="/nwscwi/topbanner.jpg" border="0">
  <tr>
    <td align="right" height="19">
      <a href="#contents"><img height="1" alt="Skip Navigation Links"
         src="/nwscwi/skipgraphic.gif" width="1" border="0"></a>
      <a href="https://www.nws.noaa.gov/" class="homepagelinks"><span class="nwslink">www.nws.noaa.gov</span></a>&nbsp;</td>
  </tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%" border="0">
  <tr>
    <td rowspan="2"><a href="https://www.noaa.gov/">
      <img height="78" alt="NOAA logo - Click to go to the NOAA home page"
      src="/nwscwi/noaaleft.jpg" width="85" border="0"></a></td>
    <td align="left"><img height="20" alt="National Weather Service"
      src="/nwscwi/nws_title.jpg" width="500" border="0"></td>
    <td rowspan="2" width="100%" background="/nwscwi/ncep_bkgrnd.jpg">&nbsp;</td>
    <td rowspan="2" align="right"><a href="https://www.nws.noaa.gov/">
      <img height="78" alt="NWS logo - Click to go to the NWS home page"
      src="/nwscwi/nwsright.jpg" width="85" border="0"></a></td>
  </tr>
  <tr>
    <td><img height="58" alt="Climate Prediction Center" src="/nwscwi/cpc.jpg"
             width="500" border="0"></td>    <!-- Put your center header image here. -->
  </tr>
</table>
<table cellspacing="0" cellpadding="0" width="100%" background="/nwscwi/navbkgrnd.gif" border="0">
  <tr>
    <td align="left" valign="top" width="94"><img height="23" alt="" src="/nwscwi/navbarleft.jpg" width
="94" border="0"></td>
    <td class="nav" align="center" width="15%">
      <a href="/products/site_index.html" class="menu">Site Map</a></td> <!-- Build a text only sitemap, and link to it via this
                                                    sitemap button just below the banner.
                                                    The sitemap should include a heirarchy of links
                                                    from NOAA, to the NWS, to NCEP, and then through your site. -->
    <td class="nav" align="right" width="15%">
      <a href="https://www.nws.noaa.gov/pa/" class="menu">News</a></td>
    <td class="nav" id="menuitem" align="right" width="20%">
      <a href="https://weather.gov/organization.php" class="menu">Organization</a></td>
    <td class="yellow" align="right" width="20%">
      <form action="https://www.firstgov.gov/fgsearch/index.jsp" name="query">
        <label for="search">Search</label>&nbsp;</td>
    <td align="left" class="searchinput" width="20%" nowrap>
      <input type="hidden" name="parsed" value="true">
      <input type="hidden" name="rn" value="3">
      <input type="hidden" name="in0" value="domain">
      <input type="hidden" name="dom0" value="nws.noaa.gov, weather.gov, wrh.noaa.gov, srh.noaa.gov, crh.noaa.gov, prh.noaa.gov, arh.noaa.gov, alaska.net/~nwsar, erh.noaa.gov, ncep.noaa.gov, wwb.noaa.gov, spc.noaa.gov, nhc.noaa.gov, sec.noaa.gov, aviationweather.gov, aviationweather.noaa.gov, weather.noaa.gov, roc.noaa.gov, nohrsc.nws.gov, nwstc.noaa.gov, wdtb.noaa.gov, npmoc.navy.mil, ndbc.noaa.gov">
      <input type="text" name="mw0" value="All NWS Search" id="search" size="20" maxlength="256">
      <input type="submit" name="Go2" value="Go"></td>
    <td width="10%">&nbsp;</form></td>
    <td align="right" valign="bottom" width="24"><img height="23" alt="" src="/nwscwi/navbarendcap.jpg"
 width="24" border="0"></td>
  </tr>
</table>
<table cellspacing="0" cellpadding="0" width="670" border="0">
  <tr valign="top">
    <td width="137"><br>
      <table cellspacing="0" cellpadding="2" width="137" border="0">
        <!-- Do not remove this section. You will need this when the City,St/zip search is implemented nationwide.-->
        <!-- <tr align="left" valign="top">
                <td class="searchinput">
                  <div id="Layer2" style="position:absolute; width:200px; height:115px; z-index:2; visibility: hidden">Search by city or zip code. Press enter or select the go button to submit request</div>
                  <form method="POST" action="https://www.srh.noaa.gov/zipcity.php">
                  <span class="yellow">Local forecast by<br>&quot;City, St&quot; or Zip Code</span><br>
                  <input type="text" name="inputstring" size="9" value="City, St">
                  <input type="submit" name="Go2" value="Go"></form></td>
        </tr> -->
         <tr>
          <td class="searchinput" align="left">
            <form action="https://www.firstgov.gov/fgsearch/index.jsp" name="query">
             <label for="search"><span class="yellow">CPC Search</span></label>
              <input type="hidden" name="parsed" value="true">
              <input type="hidden" name="rn" value="3">
              <input type="hidden" name="in0" value="domain">
              <input type="hidden" name="dom0" value="www.cpc.ncep.noaa.gov">
              <input type="text" name="mw0" id="search"  size="10" maxLength="256" value="CPC search">&nbsp;
              <input type="submit" name="Go2" value="Go">
          </form></td>
         </tr>
        <tr>
          <td class="white">
            <span class="yellow">About Us</span><br>
            &nbsp;&nbsp;&nbsp;<a href="/information/who_we_are/mission.html" class="menu">Our Mission</a><br>
            &nbsp;&nbsp;&nbsp;<a href="/information/who_we_are/" class="menu">Who We Are</a><br><br>
            <span class="yellow">Contact Us</span><br>
            &nbsp;&nbsp;&nbsp;<a href="/information/personnel/contacts.html" class="menu">CPC Information</a><br>
            &nbsp;&nbsp;&nbsp;<a href="/comment-form.html" class="menu">CPC Web Team</a><br><br>           
          </td>
        </tr>
      </table>
    </td>
    <td valign="top" align="center" width="533"><a name="contents"></a>

<!-- Begin content area -->

<table border="0" cellPadding="2" cellSpacing="0" align="center" width="533">
 <tr><td>&nbsp;</td></tr>
 <tr>
  <td>
   <font face="Verdana,arial,serif" size="1"><a href="/index.html" class="homepagelinks"><strong>HOME</strong></a> &gt; <a href="/products/monitoring_and_data" class="homepagelinks">Monitoring_and_Data</a> &gt; <a href="/products/monitoring_and_data/oadata.html" class="homepagelinks">Oceanic and Atmospheric Data</a> &gt; <a href="/products/wesley/" class="homepagelinks">Reanalysis: Atmospheric Data</a> &gt; wgrib2-new_grid</font>
  </td>
 </tr>
 <tr><td>&nbsp;</td></tr>
 <tr>
  <td>
<font color=red>
<h3 align=center>wgrib2: -new_grid</h3>
</font>


<img SRC="../icons/new.png" alt="New!" height=11 width=28>
<p>
Recently discovered bug in IPOLATES.  To avoid the bug, all grids should have a size of greater 
than 1 degree longitude.  For example, delta_longitude = 0.1 degree, then number of longitude points
needs to be &ge; 11 to make grid &gt; 1 degree.  
The IPOLATES library wanted to handle the case of a global grid going from 
xE to (x+360)E which is be encoded as going from xE to xE.  To allow for rounding errors,
a grid from xE to yE (y-x &le; 1) was condsidered to be a grid from xE to (360+x)E.
This causes a problem when the grids are &le; than 1 degree in longitude.  This bug will occur
occur for both the input and output grids.


<h3>Introduction</h3>

<p> Beginners are encouraged to read the <a href="./new_grid_intro.html">new_grid introduction</a>. 
<p>
The <font color=red>-new_grid</font> option interpolates the fields to a new
grid.  The default interpolation is bilinear but that can be changed using the
<font color=red>-new_grid_interpolation</font> option.  This option uses
scalar and vector interpolation as appropriate.  Vector interpolation is needed
for interpolating zonal and meridional winds near the poles.

<p>In order for the vector
interpolation to work, the vector quantities must be in a (U,V) order.
For example: Z200, U200, V200, Z500, U500, V500 is good.  If the data
are not in (U,V) order, you can either convert the file to the 
right order by the <a  href="./new_grid_order.html"><font color=red>-new_grid_order</font></a> option.
The other method is to sort the inventory into (U,V) order,
and interpolate the file using the sorted inventory. (See
"Example: Sorting the Inventory" to use this technique.)
If the vector quanties are not in (U,V) order, the vector quantites will 
not be interpolated. 

<p>
The option is not part of the default configuration but it included with many distributions.
The interpolation code is written
in fortran and combining fortran and C code can require some work.  (gcc/gfortran and 
clang/gfortran are already handled by the makefile.)  Getting the C and Fortran code to cooperate 
requires some system-specific knowledge and may not be possible in all cases.  Consequently 
you are on your own in getting the <font color=red>-new_grid</font> option installed.  

<p>
Operations often has to use the <font color=red>-new_grid</font> option to produce a large number 
of user grids.  Fortunately the interpolation can be made embarrassingly parallel.  A
portable single-node solution is described in <a href-"./new_grid_usage.html">here</a>.  A
multi-node solution is possible using MPI and the wgrib2 library.

<h3>Caution</h3>

<p> The <font color=red>-new_grid</font> option works in raw scan mode, so data are not
converted to sn:we order.  Conequently options that only work in  sn:we order cannot
work at the same time as the <font color=red>-new_grid</font> option.  Any option
that uses geolocation (ex.  <font color=red>-rpn</font>, <font color=red>-lon</font>)
is incompatible with <font color=red>-new_grid</font>.

<h3>Winds</h3>

Before you do an interpolation, you need to define the wind directions.
Most people want the the V winds to be in the direction of the North Pole.
With a verbose wgrib2 inventory, you will seee winds(N/S).  However, some
meteorologists want the V winds to go from grid point (i,j) to (i,j+1).
The corresponding wgrib2 notation is "winds(grid)".  See the 
<a href="./new_grid_winds.html">-new_grid_winds</a> option for more details.

<h3>Usage</h3>
<pre>
-new_grid_winds W -new_grid A B C outfile
    W = earth or grid
        earth means that the U wind goes eastward, V goes northward
        grid means that U wind goes from grid (i,j) to (i+1,j)
          which is not eastward in a Lambert-conformal or polar stereographic grids
    A, B, C are the output grid description
    outfile is an output file.  The grib2 interpolated records are written in outfile
</pre>


<h2><font color='red'>Grid description format</font></h2>

<p>
The nx and ny parameters are integers such that nx*ny &lt; 2147483648.
Angles and delta-angles are in degrees, and are rounded to micro-degrees unless
otherwise specified.  Dx and Dy are in meters and are usually rounded 
to the nearest mm.

<p> The interpolation library does not handle non-spherical grids.  The library
also has problems with grid smaller than 1 degree in longitudinal width.  It assumes
that the calculations are not precise, and the grid is global.

<pre>
<h3>General Format</h3>
-new_grid A B C outfile                                                   General format

    A                                                                     grid name with parameters
    B                                                                     X or longitude description (ex lon0:nlon:dlon)
    C                                                                     Y or latitude description (ex lat0:nlat:dlat)

<h3>Selected NCEP Grids (not in general format)</h3>
-new_grid ncep grid I outfile                                   	  I = 2,3,4,45,98,126-129,170,173,184,194,221,230,242,249
                                                                            (NCEP grid defintions)
									  t62,t126,t170,t190,t254,t382,t574,t1148,t1534
									    (NCEP Gaussian grids definitions)
                                                                          Want more ncep grids?  Modify ncep_grids.c


<h3>Latitude-Longitude Grid</h3>
-new_grid latlon lon0:nlon:dlon lat0:nlat:dlat outfile		  	  lat-lon grid
									  lat0, lon0 = degrees of lat/lon for 1st grid point 
									  nlon = number of longitudes
									  nlat = number of latitudes
									  dlon = grid cell size in degrees of longitude
									  dlat = grid cell size in degrees of latitude


<h3>Rotated Latitude-Longitude Grid (requires ip2lib_d)</h3>
-new_grid rot-ll:sp_lon:sp_lat:sp_rot lon0:nlon:dlon lat0:nlat:dlat outfile
                                                                          rotated latitude-longitude grid
                                                                          sp_lon = longitude of the South pole (for rotation)
                                                                          sp_lat = latitude of the South pole (for rotation)
                                                                          sp_rot = angle of rotation (degrees)
                                                                           The grid is defined in the rotated coordinates.
									  eat0, lon0 = degrees of lat/lon for 1st grid point 
									  nlat = number of longitudes
									  nlon = number of latitudes
									  dlon = grid cell size in degrees of longitude
									  dlat = grid cell size in degrees of latitude


<h3>Lambert Conic Grid</h3>
-new_grid lambert:lov:latin1:latin2:lad lon0:nx:dx lat0:ny:dy outfile	  Lambert conic conformal
-new_grid lambert:lov:latin1:latin2 lon0:nx:dx lat0:ny:dy outfile         lad = latin2
-new_grid lambert:lov:latin1 lon0:nx:dx lat0:ny:dy outfile                latin2 = latini lad = latin1
									  lov = longitude (degrees) where y axis is parallel to meridian
									  latin1 = first latitude from pole which cuts the secant cone
									  latin2 = second latitude from pole which cuts the secant cone
									  lad = latitude (degrees) where dx and dy are specified
									  lat0, lon0 = degrees of lat/lon for 1st grid point 
									  nx = number of grid points in X direction
									  ny = number of grid points in Y direction
									  dx = grid cell size in meters in x direction
									  dy = grid cell size in meters in y direction
                                                                          note: if latin2 >= 0, the north pole is on proj plane
                                                                                if latin2 &lt; 0, the south pole is on proj plane


<h3>Lambert Conic Grid with Centered Location</h3>
-new_grid lambertc:lov:latin1:latin2:lad lonc:nx:dx latc:ny:dy outfile    Lambert conic conformal with centered position
-new_grid lambertc:lov:latin1:latin2 lonc:nx:dx latc:ny:dy outfile        like lambert except lonc and latc replace lon0 and lat0
-new_grid lambertc:lov:latin1 lonc:nx:dx latc:ny:dy outfile               latc, lonc = degrees of lat/lon for center of the grid


<h3>Polar Stereographic Grid</h3>
-new_grid nps:lov:lad lon0:nx:dx lat0:ny:dy outfile                       north polar stereographic
-new_grid sps:lov:lad lon0:nx:dx lat0:ny:dy outfile			  south polar stereographic
									  lov = longitude (degrees) where y axis is parallel 
                                                                            to meridian
									  lad = latitude (degrees) where dx and dy are specified
                                                                            note: grib1 uses lad = 60N (nps) or 60S (sps)
                                                                            lad must be 60 (nps) or -60 (sps) (library limitation)
									  lat0, lon0 = degrees of lat/lon for 1st grid point 
									  nx = number of grid points in X direction
									  ny = number of grid points in Y direction
									  dx = grid cell distance meters in x direction at lad
									  dy = grid cell distance meters in y direction at lad


<h3>Global Gaussian Grid</h3>
-new_grid gaussian lon0:nx:dlon lat0:ny outfile                           global Gaussian grid
                                                                          lat0, lon0 = degrees of lat/lon for 1st grid point
                                                                          note: lon1 = -lon0, lat1 = lat0 + (nx-1)*dlon;
									  nx = number of grid points in X direction
									  ny = number of grid points in Y direction
                                                                             ny must be even
                                                                          dlon = degrees of longitude between adjacent grid points

                                                                          note: wgrib2 supports regional Gaussian grids, but
                                                                          the interpolation library doesn't. 

<h3>Mercator Grid</h3>
-new_grid mercator:lad lon0:nx:dx:lonn lat0:ny:dy:latn outfile            mercator grid
                                                                          lad = latitude (degrees) where dx and dy are specified
                                                                          lat0, lon0 = degrees of lat/lon for 1st grid point
                                                                          latn, lonn = degrees of lat/lon for last grid point
                                                                          nx = number of grid points in X direction
                                                                          ny = number of grid points in Y direction
                                                                          dx = grid cell distance in meters in x direction at lad (double precision)
                                                                          dy = grid cell distance in meters in y direction at lad (double precision)

                                                                          see <a href="https://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_doc/grib2_temp3-10.shtml">grib2 template</a> for the Mercator grid

                                                                          note: dx and dy are in meters unlike the grib template which is in mm (integer).
                                                                          note: dx and dy depend on the radius of the earth as specified by the grib message
                                                                          note: interpolation library assumes that earth will be spherical
                                                                          note: the mercator grid description is over specified
                                                                          User must make sure (nx,dy) is consistent with lonn
                                                                          as well as (ny,dy) is consistent with latn

lambert, nps, sps, mercator only support we:sn ordering
latlon, gaussian only support we:sn and we:ns ordering

<h3>Grib (wgrib 3.0.0, ip2lib_d)</h3>
-new_grid grib file Y                                                     grid definition from a grib file
                                                                          file=grib2 file
                                                                          Y (ignored)

                                                                          note: this option is only available on wgrib2 v3.0.0+
                                                                              using ip2lib_d (IPOLATES=3)
                                                                          note: default wind rotation is obtained from file
                                                                          note: support for grib files is limited by ip2lib_d

<h3>Location (wgrib 3.0.0, ip2lib_d)</h3>
-new_grid location list UUID                                              unstructured grid
                                                                          list = lon1:lat1:lon2:lat2:...:lon-n:lat-n
                                                                          UUID = UUID for this grid, 0 if none

                                                                          note: wind rotation is set to earth
                                                                          The locations are saved to the grib file as the first 
                                                                          and second grib messages. (3 decimal digits precision)

</pre>

<p>
Sometimes one wants to convert grib files to a common grid.  You already
have a sample grib file and you have to figure out the grid format.
For common grids, you can use the perl script 
<a href="https://ftp.cpc.ncep.noaa.gov/wd51we/wgrib2.scripts/grid_defn.pl">grid_defn.pl</a> 
to determine the grid format.  
<pre>
$ grid_defn.pl small.grb2
latlon 0.000000:2:10.000000 20.000000:2:8$ 

grid_defn.pl does not add a newline at the end of its output.
Not all grids are supported.
</pre>


<h3>Examples</h3>
<pre>
  wgrib2 IN.grb -set_grib_type same -new_grid_winds earth -new_grid latlon 100:10:1 30:20:1 OUT.grb
    Interpolates from IN.grb to OUT.grb
    Uses the same grib packing as in the input file
    Makes a 10x20, 1x1 degree lat-lon grid, lower left corner: 100E 30N


  wgrib2 IN.grb -set_grib_type same -new_grid_winds earth -new_grid ncep grid 221 OUT.grb
    Interpolates from IN.grb to OUT.grb
    Uses the same grib packing as in the input file
    Interpolates to NCEP grid 221.

  wgrib2 IN.grb -set_grib_type same -new_grid_winds earth -new_grid `grid_defn.pl OLD.grb` OUT.grb
    Interpolates from IN.grb to OUT.grb
    Uses the same grib packing as in the input file
    Interpolates using the grid format of OLD.grb (1st record)

<h3>Example: Sorting the Inventory</h3>
 In this example, U and V are not in the required order.  This
shows a sorting to the required order for -new_grid to work.

    wgrib2 201201.A | sed -e 's/:UGRD:/:UGRDa:/' -e 's/:VGRD:/:UGRDb:/'  | \
    sort -t: -k3,3 -k5,8 -k4,4 | \
    wgrib2 201201.A -i -new_grid_winds earth -new_grid ncep grid 2 201201.A.grd2

    The first line creates an inventory with new variable names: UGRD -> UGRDa and VGRD -> UGRDb
    The second line sorts the inventory so that UGRDb follows UGRDB.
    The third line regrids the file, with the order of processing controlled by the inventory.
</pre>

<h3>Type of Interpolation</h3>

The IPOLATES library (either iplib or ip2lib_d) supports a number of interpolation schemes including bilinear (default),
bicubic, neighbor and budget.  (In addition, ip2lib_d will support spectral.) 
The interpolation method can be selected by using the <font color=red>-new_grid_interpolation</font> 
option before the <font color=red>-new_grid</font> option. Some of the interpolation
options need numeric parameters which are set by the
<font color=red>-new_grid_ipopt</font> option. IPOPT is defined in the iplib library documentation.

<p>
You can use different interpolations for different variables.  For example, a
bilinear interpolation of soil or vegetation type is meaningless.  So
nearest neighbor interpolation is used instead.

<pre>
    wgrib2 IN.grb -new_grid_winds earth \
      -new_grid_interpolation bilinear \
      -if ":(VGTYP|SOTYP):" -new_grid_interpolation neighbor -fi \
      -new_grid latlon 0:360:1 90:181:-1 OUT.grb

   line 2: set default interpolation to bilinear
   line 3: if VGTYP or SOTYP then set the interpolation to nearest neighbor
   line 4: do the interpolation
</pre>
<p>
Comments (4/2018):  When you convert from a high resolution grid
to a lower resolution grid, you have to be consider changing from
the default interpolation (bilinear) to a budget interpolation.
The budget gives a better estimate of the cell average (the default
is 25 bilinear interpolations).

<h3>Changing from grid-relative to Earth-relative winds and vice versa</h3>

<p>
Most NCEP grib files use grid-relative winds.  If you want to convert to Earth-relative winds 
or grid-relative winds, you can use the <font color=red>-new_grid</font> option. 

<pre>
   To Earth relative:
     wgrib2 IN.grb -set_grib_type same -new_grid_winds earth -new_grid_interpolation neighbor \
      -new_grid `grid_defn.pl IN.grb` OUT.grb

   To Grid relative:
     wgrib2 IN.grb -set_grib_type same -new_grid_winds grid -new_grid_interpolation neighbor \
      -new_grid `grid_defn.pl IN.grb` OUT.grb

"-set_grib_type same" preserves the grib packing or compression
"-new_grid_interpolation neighbor" should be faster than the default bilinear
`grid_defn.pl IN.grb` returns the grid definition of the first grib message in IN.grb
</pre>

The limitations of the above command are
<ul>
<li> IN.grb can only have one grid type
<li> OUT.grb will have any submessages converted into messages
</ul>


<h3>Changes from copygb</h3>

People may want to convert from copygb and copygb2 to wgrib2's -new_grid. Some differences
to keep in mind.
<ol>
<li> copygb default vectors: UGRD/VGRD
<li> wgrib2 default vectors: depends on version of wgrib2. See <a href="./new_grid_vectors.html">new_grid_vectors</a>.
<li> copygb can have vectors in any order
<li> wgrib2 must have V follow U for vectors pairs
<li> copygb has bilinear, bicubic, nearest neighbor, budget, neighbor budget, and spectral interpolations.
<li> wgrib2 has bilinear, bicubic, nearest neighbor, and budget interpolations. (Spectral is in development.)
<li> wgrib2 can select the interpolation type depending on the variable (ex soil type)
<li> copygb uses fixed Earth's radius
<li> wgrib2 uses Earth's radius based on grib message
<li> wgrib2 doesn't have merging, mapthreshold or map files
<li> copygb by default, ignores the binary scaling and preserves decimal scaling
<li> wgrib2 by default, preserves binary and decimal scaling
<li> copygb does grib1.
<li> copygb2 does grib2.
<li> wgrib2 does grib2.
</ol>


<h3>Speed: Interpolation Weights</h3>

<p> The first step of the <font color=red>-new_grid</font> interpolation is
to calculate the interpolation weights.  (Each grid point on the new grid
is a weighted average of a small set of the old grid points.)
To save time for future interpolations, the last set of weights is saved.
Consequently interpolation is fastest when the input and output grids remain
don't change.  While one can have multiple <font color=red>-new_grid</font> options on
the command line, it is not recommended because the caching of the weights
wouldn't work and weights would have to be recalculated every time.

<h3>Installation</h3>

<pre>
With wgrib2 v2.0.8+, you have an option of compiling with the old iplib or
the new ip2lib_d library.  With the older versions of wgrib2, you are limited
to the old iplib or an hwrf version of that library.  It is recommended that
you use the newer ip2lib_d because it support latitude and longitudes to 
micro-degrees and the WMO definition of rotated lat-lon grids.  However,
the new library doesn't suport the NCEP local grids such as 32769 as used
by the NAM native files.

<p> With wgrib2 v2.0.8+, you set USE_IPOLATES to 3 in the makefile
for ip2lib_d.  To use the old iplib, you set USE_IPOLATES to 1.  If you
don't want the -new_grid options, you can set USE_IPOLATES to 0.
</pre>

<h3>Converting from WE:SN to WE:NS Grids</h3>
Many of wgrib2 grib2 writing options will write the grid
in WE:SN order.  This natural because geolocation is
only enabled when the internal grids are in WE:SN order.
However, some codes need the grid in WE:NS order.  To
convert a grib file from WE:SN order to WE:NS order, the
simplest way is to use -new_grid.  Lat0 and lon0 need
to be lat/lon of the top left corner of the grid.  Dlon
will a positive number and dlat will be negative.

<p>  If you want to be tricky, you can do a variation of the
"NDFD work arounds" technique.  It will be faster and 
more generic.

<h3>Thinned Gaussian Grids to other Grids</h3>
Converting from a thinned Gaussian grid is a two step process
using wgrib2.  First you convert from the thinned grid to full
grid using <a href="./reduced_gaussian_grid.html">-reduced_gaussian_grid</a>.
Then you can use -new_grid to interpolate to your desired grid.

<h3>Quilting tiles - Merging files</h3>

<p> Yes, it has been done using -new_grid, -import_grib -rpn/merge, and
the -grib_out options.  Yes, at least 3 people have done it.  The best
application combined a global oceanic and various regional oceanic forecasts.  
Priority was given to the model with the highest resolution.  This is convenient
for the user who is on a route that covers different model domains.

<h3>Limitations of the iplib library</h3>

The iplib library has its limitations.
Grids types used by NCEP get supported and others don't.  The library has a grib1 interface, so
new features of grib2 are not supported and the precision of the grid parameters
are limited to the grib1 values.  For example, latitude and longitude
values are limited to millidegrees instead of microdegrees.  Note: during
the installation of ip2, I noticed that the longitude was reduced when
reducing the range to [0,360).  (longitude = amod(longitude + 3600.0, 360.0))
For single precision numbers, this reduces the precision to about two digits after
the decimal place.  

<ol>
<li> not all grid types are supported by iplib
<li> only common grids are supported by the wgrib2 "wrapper" for iplib
<li> latitude, longitude values are nomially in millidegrees (affects interpolation)
<li> Single precision reals are used.  The effective precision of the
      longitudes is to a hunderdth of a degree.
<li> only grib1 scan order are supported (i.e., WE:SN and WE:NS)
<li> NDFD/Glahn scan order is not supported (i.e., WE|EW:SN)
<li> Earth is assumed to be spherical
<li> Lambert conformal: LatD must follow grib1 conventions
<li> Polar Stereographic: LatD must be 60 latitude (grib1 convention)
<li> nx, ny, npts must be &le; 2147483647. (Grib2 standard is 4294967295.)
<li> Spectral interpolation is not supported.
<li> grids should be at least 1 degree by 1 degree.
</ol>

<h3>Limitations of the ip2lib_d library</h3>

As of wgrib2 v2.0.8, ip2lib_d is the default interpolation library.
Ip2lib_d is the double-precision grib2-interface IPOLATES library. The
old ip2lib will remain a compile time option. The advantages of
ip2lib_d that it supports grib2 precision (one millionth of a degree),
at rotated lat-lon grids (Grid Definition Template 3.1).

<p> The speed of the single precision iplib was originally faster than
the double precision ip2lib_d. To remove this objection from converting
to the new library, a effort was made to increase the OpenMP threading.
Consequently the run time of ip2lib_d will be similar (bilinear) to much 
faster (budget) than iplib in a multiprocessor environment.

<p> Wgrib2 v3.0.0 adds an optional spectral interpolation.

<ol>
<li> supports more grids than iplib including WMO defined rotated lat-lon.
<li> latitude, longitude values are in microdegrees (affects interpolation)
<li> Double precision reals are used.  (Wgrib2 stores is grid point values
     as single precision.)
<li> grib1 polar stereographic projection, LaD = 60N or 60S has been removed
<li> NDFD/Glahn scan order (i.e., WE|EW:SN) may be supported in the future.
<li> staggering will be supported unlike iplib
<li> Some interpolations support an ellipical earth.
<li> Lambert conformal: LatD must follow grib1 conventions
<li> nx, ny, npts must be &le; 2147483647. (Grib2 standard is 4294967295.)
   This is a limitation of compiling using 4 byte integers.
<li> Does not support local NCEP grid definitions such as 32769
<li> Spectral interpolation is limited to global fields with no undefined values.
<li> grids should be at least 1 degree by 1 degree.
</ol>

<h3>NDFD work arounds</h3>
<h3>*** FATAL ERROR: mk_kgds: unsupported scan mode 80 ***</h3>

The <font color=red>new_grid</font> option will give the following error
<pre>
*** FATAL ERROR: mk_kgds: unsupported scan mode 80
</pre>
when trying to regrid a field that is written in (WE|EW):SN order.
The (WE|EW):SN order means that the odd rows 
are in WE order and the even rows are EW order.  
The rows go from south to north.  
This scan order is commonly used by NDFD in order to make newbies
brain hurt.  Try writting a program to get the lat-lon of the Nth
grid point.

<p>
The (WE|EW):SN order
is not supported by the ipolates library which does the regridding for
the -new_grid option.  The simplest work around is to convert
the grid to a WE:SN order.

<ol>  Version 0
<li> for data in input=WE|EW:SN scan order (wgrib2 IN -scan)
<li> read data, change order scan order of data, change flag table 3.4, save data
<li> wgrib2 IN.grb -rpn alt_x_scan -set table_3.4 64 -grib_out OUT.grb
</ol>

<ol>  Version 1
<li> Read trick 55 in <a href="https://ftp.cpc.ncep.noaa.gov/wd51we/wgrib2/tricks.wgrib2">wgrib2 tricks</a>
</ol>
<p>
A variation of the previous trick can be used to put WE:SN data to (WE|EW):SN packing.
<p>
See also: 
<a href="./new_grid_format.html">-new_grid_format</a>,
<a href="./new_grid_intro.html">new_grid introduction</a>,
<a href="./new_grid_interpolation.html">-new_grid_interpolation</a>,
<a href="./new_grid_order.html">new_grid order</a>,
<a href="./new_grid_winds.html">-new_grid_winds</a>,
<a href="./new_grid_vectors.html">-new_grid_vectors</a>,
<a href="./lola.html">-lola</a>,
<a href="./bin.html">-bin</a>,
<a href="./import_bin.html">-import_bin</a>,
<a href="./rpn.html">-rpn</a>,
<a href="./grib_out.html">-grib_out</a>,
<a href="./new_grid_usage.html">new_grid multi-core usage</a>,

</td>
</tr>


<!--  End of Content area  -->
<!--   ...............................................Footer Portion.........................................    -->
 <tr>
  <td>
   <table width="500">
    <tr>
     <td colSpan="3"><hr></td>
    </tr>
    <TR vAlign="top">
     <TD class="gray">
      <A href="https://www.noaa.gov/" class="homepagelinks"><SPAN class="gray">NOAA/</SPAN></A>
      <A href="https://www.nws.noaa.gov/" class="homepagelinks"><SPAN class="gray">National Weather Service</SPAN></A><BR>
      <A href="https://www.ncep.noaa.gov/" class="homepagelinks"><SPAN class="gray">National Centers for Environmental Prediction</SPAN></a><BR>
        Climate Prediction Center<BR>
        5830 University Research Court<BR>
        College Park, Maryland 20740<BR>
      <A href="/comment-form.html" class="homepagelinks"><SPAN class="gray">Climate Prediction Center Web Team</SPAN></A><BR>
        Page last modifications:  June 17, 2019, Nov 5, 2019, Feb 14, 2020, Feb 2, 2021, June 7, 2021. Feb 2024, april 2024, July 2024
     </TD>
     <TD>
      <A href="https://weather.gov/disclaimer.php" class="homepagelinks"><SPAN class="gray">Disclaimer</SPAN></A>
     </TD>
     <TD align="right">
      <A href="https://weather.gov/privacy.php" class="homepagelinks"> <SPAN class="gray">Privacy Policy</SPAN></A>
     </TD>
    </TR>
   </table>
  </td>
 </tr>
</table>
</td>
</tr>
</table>
</body>
</html>

